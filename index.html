<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>projectCook - MultiPage Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #f8fafc; font-family: -apple-system, system-ui, sans-serif; }
        .page { display: none; padding-bottom: 30px; }
        .page-active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .menu-card { background: white; border-radius: 24px; padding: 20px; text-align: center; border: 1px solid #f1f5f9; box-shadow: 0 4px 12px rgba(0,0,0,0.02); transition: transform 0.1s; }
        .menu-card:active { transform: scale(0.95); background: #f1f5f9; }
        .tg-btn { background: #007aff; color: white; font-weight: bold; border-radius: 16px; padding: 14px; width: 100%; transition: opacity 0.2s; }
        .tg-btn:disabled { opacity: 0.5; }
    </style>
</head>
<body class="p-4">

    <main id="page-main" class="page page-active">
        <header class="mb-8 mt-4 text-center">
            <h1 class="text-3xl font-black text-gray-900 tracking-tighter">projectCook</h1>
            <p class="text-blue-500 font-bold text-[10px] uppercase tracking-widest mt-1">–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ö–Ω–µ–π</p>
        </header>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="nav('warehouse')" class="menu-card">
                <span class="text-3xl block mb-2">üì¶</span>
                <span class="text-xs font-bold uppercase text-gray-700">–°–∫–ª–∞–¥</span>
            </button>
            <button onclick="nav('ingredients')" class="menu-card">
                <span class="text-3xl block mb-2">ü•ï</span>
                <span class="text-xs font-bold uppercase text-gray-700">–ü—Ä–æ–¥—É–∫—Ç—ã</span>
            </button>
            <button onclick="nav('recipes')" class="menu-card">
                <span class="text-3xl block mb-2">üìñ</span>
                <span class="text-xs font-bold uppercase text-gray-700">–†–µ—Ü–µ–ø—Ç—ã</span>
            </button>
            <button onclick="nav('shopping')" class="menu-card">
                <span class="text-3xl block mb-2">üõí</span>
                <span class="text-xs font-bold uppercase text-gray-700">–ü–æ–∫—É–ø–∫–∏</span>
            </button>
        </div>
        
        <div class="mt-8 bg-blue-50 p-6 rounded-[32px] border border-blue-100">
            <h3 class="font-bold text-blue-900 text-sm mb-2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–ª–∞–∫–∞</h3>
            <p class="text-[11px] text-blue-700 font-medium">–í–∞—à–∞ –±–∞–∑–∞ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.</p>
        </div>
    </main>

    <main id="page-warehouse" class="page">
        <button onclick="nav('main')" class="text-blue-500 font-bold text-sm mb-6 flex items-center gap-1">‚Üê –ù–∞–∑–∞–¥</button>
        <h2 class="text-2xl font-black mb-6">–°–∫–ª–∞–¥</h2>
        <div id="warehouse-list" class="space-y-3"></div>
    </main>

    <main id="page-ingredients" class="page">
        <button onclick="nav('main')" class="text-blue-500 font-bold text-sm mb-6 flex items-center gap-1">‚Üê –ù–∞–∑–∞–¥</button>
        <h2 class="text-2xl font-black mb-4">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h2>
        
        <div class="bg-white p-5 rounded-3xl border mb-6">
            <input id="ing-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="w-full mb-3 p-3 bg-gray-50 rounded-xl outline-none">
            <div class="flex gap-2 mb-3">
                <input id="ing-price" type="number" placeholder="–¶–µ–Ω–∞ ‚ÇΩ" class="w-1/2 p-3 bg-gray-50 rounded-xl outline-none">
                <input id="ing-unit" type="text" placeholder="–ï–¥. (–∫–≥/—à—Ç)" class="w-1/2 p-3 bg-gray-50 rounded-xl outline-none">
            </div>
            <button onclick="addIngredient()" class="tg-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É</button>
        </div>
        
        <div id="ingredients-list" class="space-y-3"></div>
    </main>

    <main id="page-recipes" class="page">
        <button onclick="nav('main')" class="text-blue-500 font-bold text-sm mb-6 flex items-center gap-1">‚Üê –ù–∞–∑–∞–¥</button>
        <h2 class="text-2xl font-black mb-6">–†–µ—Ü–µ–ø—Ç—ã</h2>
        <div id="recipes-list" class="space-y-4"></div>
    </main>

    <main id="page-shopping" class="page">
        <button onclick="nav('main')" class="text-blue-500 font-bold text-sm mb-6 flex items-center gap-1">‚Üê –ù–∞–∑–∞–¥</button>
        <h2 class="text-2xl font-black mb-6">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
        <div id="shopping-list" class="space-y-3"></div>
    </main>

    <main id="page-recipe-detail" class="page">
        <button onclick="nav('recipes')" class="text-blue-500 font-bold text-sm mb-6 flex items-center gap-1">‚Üê –ö —Å–ø–∏—Å–∫—É —Ä–µ—Ü–µ–ø—Ç–æ–≤</button>
        <div id="recipe-content"></div>
    </main>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const SUPABASE_URL = 'https://fwgxtjkqmslbmnecfhwj.supabase.co';
        const SUPABASE_KEY = 'Sb_publishable_27NdQpJDXhOWC_Y7kzNn7A__xs0jCUi';
        const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_KEY);

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        function nav(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('page-active'));
            document.getElementById('page-' + pageId).classList.add('page-active');
            
            if(pageId === 'warehouse') loadWarehouse();
            if(pageId === 'ingredients') loadIngredients();
            if(pageId === 'recipes') loadRecipes();
            if(pageId === 'shopping') loadShopping();
        }

        // 1. –°–ö–õ–ê–î
        async function loadWarehouse() {
            const { data } = await supabase.from('–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å').select('*');
            const list = document.getElementById('warehouse-list');
            list.innerHTML = data?.map(item => `
                <div class="p-4 bg-white rounded-2xl border flex justify-between items-center">
                    <div><p class="font-bold">${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}</p><p class="text-xs text-gray-400">–í –Ω–∞–ª–∏—á–∏–∏: ${item.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ} ${item.–µ–¥_–∏–∑–º || ''}</p></div>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">${item.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ > 0 ? '–ï—Å—Ç—å' : '–ù–µ—Ç'}</span>
                </div>
            `).join('') || '<p class="text-center text-gray-400">–°–∫–ª–∞–¥ –ø—É—Å—Ç</p>';
        }

        // 2. –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´
        async function loadIngredients() {
            const { data } = await supabase.from('products').select('*').order('name', {ascending: true});
            const list = document.getElementById('ingredients-list');
            list.innerHTML = data?.map(item => `
                <div class="p-4 bg-white rounded-2xl border flex justify-between items-center">
                    <div><p class="font-bold">${item.name}</p><p class="text-xs text-gray-400">${item.unit || ''}</p></div>
                    <p class="font-black text-blue-600">${item.price} ‚ÇΩ</p>
                </div>
            `).join('') || '';
        }

        async function addIngredient() {
            const name = document.getElementById('ing-name').value;
            const price = document.getElementById('ing-price').value;
            const unit = document.getElementById('ing-unit').value;
            if(!name || !price) return;
            await supabase.from('products').insert([{ name, price: parseFloat(price), unit }]);
            loadIngredients();
            tg.HapticFeedback.impactOccurred('light');
        }

        // 3. –†–ï–¶–ï–ü–¢–´
        async function loadRecipes() {
            const { data } = await supabase.from('recipes').select('*');
            const list = document.getElementById('recipes-list');
            list.innerHTML = data?.map(rec => `
                <div onclick="openRecipe('${rec.id}')" class="p-5 bg-white rounded-3xl border shadow-sm">
                    <h3 class="font-black text-lg text-gray-800">${rec.name || rec.–Ω–∞–∑–≤–∞–Ω–∏–µ}</h3>
                    <p class="text-sm text-gray-400 mt-1 line-clamp-2">${rec.description || rec.–æ–ø–∏—Å–∞–Ω–∏–µ || ''}</p>
                    <div class="mt-3 flex items-center text-blue-500 text-xs font-bold">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—Ü–µ–ø—Ç ‚Üí</div>
                </div>
            `).join('') || '';
        }

        // 5. –ü–û–õ–ù–´–ô –†–ï–¶–ï–ü–¢
        async function openRecipe(id) {
            nav('recipe-detail');
            const { data: rec } = await supabase.from('recipes').select('*').eq('id', id).single();
            const { data: ingrs } = await supabase.from('recipe_ingredients').select('*').eq('recipe_id', id);
            
            const content = document.getElementById('recipe-content');
            content.innerHTML = `
                <h2 class="text-3xl font-black mb-4">${rec.name || rec.–Ω–∞–∑–≤–∞–Ω–∏–µ}</h2>
                <div class="bg-blue-50 p-5 rounded-3xl mb-6">
                    <h4 class="font-bold text-xs uppercase text-blue-500 mb-3">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h4>
                    <ul class="space-y-2">
                        ${ingrs?.map(i => `<li class="text-sm flex justify-between border-b border-blue-100 pb-1">
                            <span>${i.ingredient_name}</span>
                            <span class="font-bold">${i.amount}</span>
                        </li>`).join('') || '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}
                    </ul>
                </div>
                <h4 class="font-bold text-xs uppercase text-gray-400 mb-2">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h4>
                <p class="text-gray-700 leading-relaxed">${rec.instructions || rec.–æ–ø–∏—Å–∞–Ω–∏–µ || '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è...'}</p>
            `;
        }

        // 4. –ü–û–ö–£–ü–ö–ò
        async function loadShopping() {
            const { data } = await supabase.from('—Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫').select('*');
            const list = document.getElementById('shopping-list');
            list.innerHTML = data?.map(item => `
                <div class="p-4 bg-white rounded-2xl border flex items-center gap-3">
                    <input type="checkbox" class="w-5 h-5 accent-blue-500">
                    <span class="font-medium">${item.–ø—Ä–æ–¥—É–∫—Ç}</span>
                    <span class="ml-auto text-xs text-gray-400">${item.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ || ''}</span>
                </div>
            `).join('') || '<p class="text-center text-gray-400">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
        }

        // –°—Ç–∞—Ä—Ç
        nav('main');
    </script>
</body>
</html>

